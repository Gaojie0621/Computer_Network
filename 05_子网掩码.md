# 子网掩码（Subnet Mask）

> **子网掩码（Subnet Mask）** 是用于**划分IP地址中网络部分和主机部分**的关键工具。它决定了IP地址属于哪个**子网**，并帮助路由器判断数据包是发送到本地网络还是外部网络。

## 为什么需要子网掩码？

- **IP地址分类问题**：IPv4地址分为A、B、C类（如 192.168.1.1），但固定分类不够灵活，导致IP浪费或不足。
- **提高IP利用率**：通过子网划分，可以更精细地分配IP，减少浪费。
- **优化网络管理**：不同部门/区域可以使用独立的子网，便于管理和安全控制。

### IP地址的组成

一个IPv4地址（如 192.168.1.100）由两部分组成：

- **网络部分（Network ID）**：标识所属的网络（如 192.168.1）
- **主机部分（Host ID）**：标识该网络中的具体设备（如 .100）

> **子网掩码的作用就是告诉计算机：IP地址的哪部分是网络，哪部分是主机。**

### 子网掩码的表示方式

#### (1) 点分十进制表示法
与IP地址格式相同，如 255.255.255.0。

- 255 对应的部分属于网络位
- 0 对应的部分属于主机位

例如：
- IP：192.168.1.100
- 子网掩码：255.255.255.0
- 网络部分：192.168.1（前24位）
- 主机部分：.100（后8位）

#### (2) CIDR表示法（无类别域间路由）
更简洁的表示方式，如 /24（等同于 255.255.255.0）。

数字表示网络位的长度：
- /24 = 前24位是网络位（255.255.255.0）
- /16 = 前16位是网络位（255.255.0.0）

## 子网掩码如何工作？

#### 示例1：判断两个IP是否在同一子网
IP1：192.168.1.100，子网掩码 255.255.255.0
IP2：192.168.1.200，子网掩码 255.255.255.0

**步骤：**
1. 将IP和子网掩码转换为二进制：
   - 192.168.1.100 → 11000000.10101000.00000001.01100100
   - 255.255.255.0 → 11111111.11111111.11111111.00000000

2. 进行按位AND运算（网络部分保留，主机部分清零）：
   - 11000000.10101000.00000001.00000000 → 192.168.1.0（网络ID）

3. 同理计算 192.168.1.200 的网络ID也是 192.168.1.0

**结论：** 两个IP在同一子网，可以直接通信。

#### 示例2：不同子网的IP
- IP1：192.168.1.100，子网掩码 255.255.255.0（网络ID：192.168.1.0）
- IP2：192.168.2.100，子网掩码 255.255.255.0（网络ID：192.168.2.0）

**结论：** 不在同一子网，需通过路由器转发。



## 子网划分（Subnetting）

##### 通过调整子网掩码，可以将一个大网络划分为多个小网络（子网），提高IP利用率。

#### 示例：将 192.168.1.0/24 划分为4个子网

**原始网络：**
- IP范围：192.168.1.0 ~ 192.168.1.255
- 子网掩码：255.255.255.0（/24）
- 可用主机：254个（去掉全0和全1地址）

**划分4个子网：**
- 需要借用2位主机位（因为 2² = 4）
- 新子网掩码：255.255.255.192（/26，前26位是网络位）

**每个子网的IP范围：**
1. 子网1：192.168.1.0 ~ 192.168.1.63（网络ID：192.168.1.0）
2. 子网2：192.168.1.64 ~ 192.168.1.127（网络ID：192.168.1.64）
3. 子网3：192.168.1.128 ~ 192.168.1.191（网络ID：192.168.1.128）
4. 子网4：192.168.1.192 ~ 192.168.1.255（网络ID：192.168.1.192）

> **每个子网可用主机：2⁶ - 2 = 62 个**


#### 特殊子网掩码地址

- **255.255.255.255**：广播地址（发送给所有设备）
- **0.0.0.0**：默认路由（匹配任何IP）


## 默认子网掩码（Classful Network）

在早期分类网络中，子网掩码由IP地址类别决定：

| IP类别 | 默认子网掩码 | 示例IP范围 | 网络位长度 |
|--------|--------------|------------|------------|
| A类    | 255.0.0.0    | 1.0.0.1 ~ 126.255.255.254 | /8 |
| B类    | 255.255.0.0  | 128.0.0.1 ~ 191.255.255.254 | /16 |
| C类    | 255.255.255.0 | 192.0.0.1 ~ 223.255.255.254 | /24 |

现代网络已采用CIDR（无类别寻址），不再严格依赖A/B/C类划分。


## 如何计算子网掩码？

#### 方法1：根据主机数量
**如果需要至少 N 台主机：**
1. 计算满足 2ʰ - 2 ≥ N 的最小 h（主机位数）
2. 子网掩码 = 32 - h（CIDR表示法）

 - 示例：需要50台主机：
    - 2⁶ - 2 = 62 ≥ 50 → 主机位 h=6
    - 子网掩码 = 32 - 6 = 26（即 255.255.255.192）

#### 方法2：根据子网数量
**如果需要 M 个子网：**
1. 计算满足 2ˢ ≥ M 的最小 s（子网位数）
2. 新子网掩码 = 原掩码位数 + s

 - 示例：原网络 192.168.1.0/24，划分8个子网：
    - 2³ = 8 → 需要3位
    - 新子网掩码 = 24 + 3 = 27（即 255.255.255.224）


### 实际应用

#### (1) 家庭路由器
- 通常使用 192.168.1.0/24（子网掩码 255.255.255.0）
- 可用IP：192.168.1.1 ~ 192.168.1.254

#### (2) 企业网络
划分多个子网，如：
- 财务部：10.0.1.0/24
- 技术部：10.0.2.0/24
- 通过路由器互联
