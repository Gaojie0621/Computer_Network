**什么是IP地址？**
 > IP地址（Internet Protocol Address）是互联网上设备的唯一标识，类似于现实中的“门牌号”，用于设备之间的通信。

IP地址分为：

 - IPv4（如 192.168.1.1，32位，约42亿个，已接近枯竭）

 - IPv6（如 2001:0db8:85a3::8a2e:0370:7334，128位，几乎无限）
 
## 1. 公网IP vs 私网IP
#### **公网IP（Public IP）**

是什么：就像你家在现实世界中的“邮寄地址”，是全球唯一的。比如 8.8.8.8（Google的DNS服务器）。

**作用:** 公网IP是互联网上设备的唯一标识，任何联网的设备（比如网站服务器）都需要公网IP才能被直接访问。


**特点：**

 - 数量有限（IPv4只有约42亿个），需要花钱租用。

 - 直接暴露在互联网上，可能被攻击，通常需要防火墙保护。


#### **私网IP（Private IP）**
是什么：就像你家内部的“房间号”（比如客厅、卧室），只在本地网络有效。常见的私网IP段：

192.168.x.x（比如你家路由器的 192.168.1.1）

10.x.x.x、172.16.x.x～172.31.x.x

**作用：** 局域网（比如家庭、公司内网）的设备用私网IP互相通信，但无法直接被互联网访问。


**特点：**

 - 免费且可重复使用（你家和邻居家都可以用 192.168.1.1）。

 - 需要靠NAT技术才能访问互联网。

### 1.1 NAT（网络地址转换）
**为什么需要NAT？**
问题：私网IP（比如你的手机 192.168.1.100）不能直接上网，因为互联网只认公网IP。

解决：路由器通过NAT把你的私网IP“翻译”成公网IP。

**NAT的工作原理**
场景：你用手机（192.168.1.100）访问百度（220.181.38.148）。

**步骤：**

 - 手机发送请求到路由器：“我要访问百度”。

 - 路由器把你的私网IP（192.168.1.100）替换成它的公网IP（比如 120.80.1.1），并记录这个连接（像登记表）。

 - 百度回复时，路由器根据登记表把数据转给你的手机。

**NAT的类型**
 - 一对一：一个私网IP固定映射到一个公网IP（企业常用）。

 - 多对一（PAT）：多个设备共享一个公网IP（家庭路由器常用，靠端口号区分设备）。

 **类比**

就像公司前台：

你（私网IP）打电话给客户（互联网），前台（NAT路由器）用公司总机（公网IP）替你拨号。
客户回拨时，前台根据分机号转接给你。

### 1.2 DNS解析
**为什么需要DNS？**
问题：人类记不住IP（比如 220.181.38.148），但能记住域名（比如 www.baidu.com）。

解决：DNS把域名翻译成IP，像“电话簿”。

**DNS解析过程**
 - 输入网址：你在浏览器输入 www.baidu.com。

 - 本地查询：

    - 先查浏览器缓存 → 电脑缓存 → 路由器缓存。

    - 如果没有，问本地DNS服务器（通常是ISP提供的，比如电信的 114.114.114.114）。

 - 递归查询：

    - 本地DNS问根域名服务器（全球13组）：“.com是谁管？”。

    - 根服务器返回 .com 的顶级域名服务器地址。

    - 本地DNS再问 .com 服务器：“baidu.com是谁管？”。

    - 最后拿到 www.baidu.com 的IP（比如 220.181.38.148）。

 - 返回结果：浏览器用这个IP访问百度服务器。

**类比**

就像问路：

你问“新华书店在哪？”（域名）。

本地向导（DNS）先查自己的记事本（缓存），没有就去问更高级的导航系统（根域名服务器）。

最终告诉你“新华书店在人民路123号”（IP地址）。

### 1.3 整体流程举例
假设你用家里的WiFi（私网IP）访问百度：

 - 你的电脑（192.168.1.100）问DNS：“www.baidu.com的IP是多少？” → 拿到 220.181.38.148。

 - 路由器通过NAT把你的请求包源IP从 192.168.1.100 改成公网IP 120.80.1.1，发往百度。

 - 百度回复 120.80.1.1，路由器根据NAT记录转给 192.168.1.100。

 - 你看到百度网页。

### 1.4 家庭网络中的IP分配
**（1）家庭路由器的IP**
 - WAN口（外网接口）：
路由器连接光猫/宽带时，运营商会分配一个公网IP（或运营商内网的“伪公网IP”）给路由器的WAN口。

    - 如果是真公网IP：比如 120.80.1.1（全球唯一，可直接被互联网访问）。

    - 如果是运营商内网IP：比如 10.100.100.100（运营商共享IP，家庭越来越常见，需通过运营商NAT上网）。

**（2）家庭内网设备**
路由器通过DHCP自动给连接的设备（手机、电脑等）分配私网IP，比如：

你的电脑：192.168.1.100

你的手机：192.168.1.101

路由器本身：192.168.1.1（网关地址）

这些私网IP只在家庭局域网内有效，无法直接被互联网访问。


#### 家庭上网的完整流程（结合NAT和DNS）
假设你用电脑访问 www.baidu.com：

**1. DNS解析：**

 - 电脑问DNS服务器：“www.baidu.com的IP是多少？” → 拿到 220.181.38.148。

**2. 发送请求：**

 - 电脑（192.168.1.100）将数据包发给路由器（192.168.1.1）。

**3. NAT转换：**

 - 路由器把数据包的源IP从 192.168.1.100 改成自己的公网IP（如 120.80.1.1），并记录连接（端口号映射）。

**4. 互联网传输：**

 - 百度收到请求，回复给路由器的公网IP 120.80.1.1。

**5. NAT反向转换：**

 - 路由器根据记录，将回复转发给电脑 192.168.1.100。


## 总结
公网IP：互联网上的“身份证”，全球唯一。

私网IP：局域网内部的“门牌号”，可重复使用。

NAT：把私网IP“伪装”成公网IP上网的技术。

DNS：把域名（如 www.baidu.com）翻译成IP的“翻译官”。